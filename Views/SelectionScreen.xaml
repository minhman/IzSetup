<UserControl x:Class="IzSetup.Views.SelectionScreen"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White"
             DataContext="{Binding SelectionViewModel, RelativeSource={RelativeSource AncestorType=Window}}">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Tabs -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
            <Button Content="Install" Padding="20,10" Margin="0,0,5,0" 
                    Background="{Binding SelectedTab, Converter={StaticResource SelectedTabConverter}, ConverterParameter=Install}"
                    Foreground="White" BorderThickness="0"
                    Command="{Binding SelectTabCommand}" CommandParameter="Install"/>
            <Button Content="Installed" Padding="20,10" Margin="5,0,5,0"
                    Background="{Binding SelectedTab, Converter={StaticResource SelectedTabConverter}, ConverterParameter=Installed}"
                    Foreground="White" BorderThickness="0"
                    Command="{Binding SelectTabCommand}" CommandParameter="Installed"/>
            <Button Content="Update" Padding="20,10" Margin="5,0,0,0"
                    Background="{Binding SelectedTab, Converter={StaticResource SelectedTabConverter}, ConverterParameter=Update}"
                    Foreground="White" BorderThickness="0"
                    Command="{Binding SelectTabCommand}" CommandParameter="Update"/>
        </StackPanel>

        <!-- Search and Filter Panel -->
        <Border Grid.Row="1" Background="#F0F0F0" Padding="15" CornerRadius="5" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search Box -->
                <TextBox Grid.Column="0" x:Name="SearchBox"
                         Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                         Padding="10" VerticalAlignment="Center"
                         Foreground="#333333" Background="White"
                         BorderThickness="1" BorderBrush="#CCCCCC"/>

                <!-- Category Filter -->
                <ComboBox Grid.Column="1" Margin="10,0,0,0"
                          ItemsSource="{Binding Categories}"
                          SelectedItem="{Binding SelectedCategory}"
                          Padding="10" VerticalAlignment="Center"
                          Background="White" BorderThickness="1" BorderBrush="#CCCCCC"/>

                <!-- Control Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="10,0,0,0" VerticalAlignment="Center">
                    <Button Command="{Binding SelectAllCommand}" Content="Select All" Padding="10,5" Margin="0,0,5,0" Background="#27AE60" Foreground="White" BorderThickness="0"/>
                    <Button Command="{Binding DeselectAllCommand}" Content="Deselect All" Padding="10,5" Background="#E74C3C" Foreground="White" BorderThickness="0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Selected Count -->
        <TextBlock Grid.Row="2" Text="{Binding SelectedCountText}" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="#0078D4"/>

        <!-- Software Grid (Ninite Style) -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding SoftwareList}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" Background="White"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Width="160" Height="210" Margin="10" Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8" Padding="12">
                            <Grid Background="Transparent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Checkbox at top-right -->
                                <CheckBox Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Top"
                                          IsChecked="{Binding IsSelected, Mode=TwoWay}"/>

                                <!-- Icon/Logo Area -->
                                <Border Grid.Row="1" Height="48" Width="48" HorizontalAlignment="Center" Margin="0,8,0,0"
                                        Background="#F0F0F0" CornerRadius="4">
                                    <TextBlock Text="ðŸ“¦" FontSize="32" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>

                                <!-- Software Name -->
                                <TextBlock Grid.Row="2" Text="{Binding Name}" 
                                           FontWeight="Bold" FontSize="12" 
                                           Foreground="#333333" 
                                           TextAlignment="Center" 
                                           Margin="0,8,0,2"
                                           TextWrapping="Wrap"
                                           MaxHeight="32"/>

                                <!-- Publisher -->
                                <TextBlock Grid.Row="3" Text="{Binding Publisher}" 
                                           FontSize="10" Foreground="#666666" 
                                           TextAlignment="Center" 
                                           Margin="0,2,0,4"
                                           TextWrapping="Wrap"/>

                                <!-- Version Info (for Update tab) -->
                                <StackPanel Grid.Row="4" Orientation="Vertical" HorizontalAlignment="Center" 
                                            Visibility="{Binding InstallationStatus, Converter={StaticResource StatusToVisibilityConverter}, ConverterParameter=UpdateAvailable}">
                                    <TextBlock Text="Current:" FontSize="8" Foreground="#999999" TextAlignment="Center"/>
                                    <TextBlock Text="{Binding InstalledVersion}" FontSize="9" Foreground="#666666" TextAlignment="Center" FontWeight="Bold"/>
                                    <TextBlock Text="New:" FontSize="8" Foreground="#999999" TextAlignment="Center" Margin="0,4,0,0"/>
                                    <TextBlock Text="{Binding Version}" FontSize="9" Foreground="#27AE60" TextAlignment="Center" FontWeight="Bold"/>
                                </StackPanel>

                                <!-- Category Badge -->
                                <Border Grid.Row="5" Background="#E8F0F7" CornerRadius="3" Padding="6,2" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Category}" FontSize="9" Foreground="#0078D4" TextAlignment="Center"/>
                                </Border>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
